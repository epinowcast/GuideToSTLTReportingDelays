name: Glossary Links

on:
  push:
    branches: [main]
    paths:
      - "**.qmd"
      - "scripts/link-glossary.jl"
  workflow_dispatch:

permissions:
  contents: write
  pull-requests: write

jobs:
  link-glossary:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup Julia
        uses: julia-actions/setup-julia@v2
        with:
          version: "1"

      - name: Run glossary linker
        run: julia scripts/link-glossary.jl

      - name: Check for changes
        id: changes
        run: |
          if [ -n "$(git diff --name-only)" ]; then
            echo "has-changes=true" >> $GITHUB_OUTPUT
          else
            echo "has-changes=false" >> $GITHUB_OUTPUT
          fi

      - name: Create pull request
        if: steps.changes.outputs.has-changes == 'true'
        uses: peter-evans/create-pull-request@v7
        with:
          commit-message: "docs: link glossary terms in website pages"
          branch: auto/glossary-links
          title: "Link glossary terms in website pages"
          body: |
            Automated PR to link first use of glossary terms
            to their definitions.

            Generated by `scripts/link-glossary.jl`.

            This was opened by a bot. Please ping @seabbs
            for any questions.
          delete-branch: true
